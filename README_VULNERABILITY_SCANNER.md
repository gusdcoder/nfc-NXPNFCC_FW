# NFC Host Card Emulation (HCE) Vulnerability Scanner

This repository contains a comprehensive vulnerability analysis toolkit for NFC Host Card Emulation implementations. The toolkit supports both rooted and non-rooted Android devices and includes optional Frida-based dynamic analysis capabilities.

## Overview

Host Card Emulation (HCE) allows Android applications to emulate smart cards without requiring a secure element. While this technology enables innovative payment and identification solutions, it also introduces security risks that need to be carefully assessed.

This toolkit provides:

- **Static firmware analysis** of NFC controller binaries
- **Dynamic HCE application analysis** on Android devices  
- **Root and non-root testing modes** for different access levels
- **Frida-based instrumentation** for advanced runtime analysis
- **Comprehensive vulnerability reporting** with remediation guidance

## Components

### 1. Main Vulnerability Scanner (`hce_vuln_scanner.py`)

The primary tool that orchestrates firmware analysis and device testing.

**Features:**
- Scans NFC firmware binaries for vulnerability patterns
- Analyzes HCE implementations on connected Android devices
- Supports both rooted and non-rooted access modes
- Optional Frida integration for dynamic analysis
- Generates comprehensive vulnerability reports

**Usage:**
```bash
# Scan firmware directory only
python3 hce_vuln_scanner.py --scan-firmware ./InfraFW

# Scan connected device with Frida
python3 hce_vuln_scanner.py --scan-device --use-frida

# Complete scan with root access
python3 hce_vuln_scanner.py --scan-all --root --device-id emulator-5554

# Generate report to file
python3 hce_vuln_scanner.py --scan-all --output vulnerability_report.json
```

### 2. Non-Root HCE Analyzer (`non_root_hce_analyzer.py`)

Specialized tool for analyzing HCE implementations without requiring root access.

**Features:**
- Enumerates HCE-enabled applications
- Checks HCE service permissions and configurations
- Tests for AID (Application Identifier) conflicts
- Analyzes NFC intent handling vulnerabilities
- Works entirely through ADB without privileged access

**Usage:**
```bash
# Analyze HCE applications
python3 non_root_hce_analyzer.py --analyze-apps --device-id <device_id>

# Check NFC intent handling
python3 non_root_hce_analyzer.py --check-intents

# Test for AID conflicts
python3 non_root_hce_analyzer.py --test-aids

# Run all analyses
python3 non_root_hce_analyzer.py --all --output nonroot_analysis.json
```

### 3. Frida HCE Analyzer (`frida_hce_analyzer.py`)

Advanced dynamic analysis tool using Frida instrumentation framework.

**Features:**
- Real-time APDU command interception and analysis
- HCE service method hooking and monitoring
- Security policy bypass detection
- Memory analysis for sensitive data leakage
- Suspicious activity pattern recognition

**Usage:**
```bash
# Monitor NFC service for 60 seconds
python3 frida_hce_analyzer.py --duration 60

# Target specific application
python3 frida_hce_analyzer.py --target-app com.example.hceapp --spawn

# Generate detailed analysis report
python3 frida_hce_analyzer.py --duration 300 --output frida_analysis.json
```

## Vulnerability Categories

The scanner detects several categories of vulnerabilities:

### Firmware Vulnerabilities
- **Stack overflow patterns** in ARM firmware code
- **Hardcoded cryptographic keys** in firmware binaries
- **Debugging artifacts** and test patterns
- **Buffer overflow indicators** in data structures

### HCE Application Vulnerabilities
- **Overprivileged permissions** for NFC operations
- **Exported HCE services** without proper protection
- **Debuggable applications** handling sensitive data
- **Multiple HCE category registrations** by single apps

### Runtime Vulnerabilities (Frida-detected)
- **Unauthorized default service changes** for payments
- **Suspicious APDU command patterns**
- **Security policy bypass attempts**
- **Sensitive data exposure** in memory
- **Unusual transaction patterns**

### System-Level Vulnerabilities
- **AID conflicts** between applications
- **NFC routing table manipulation**
- **Intent filter hijacking** for NFC events
- **Secure Element bypass** vulnerabilities

## Installation

### Prerequisites

1. **Python 3.7+**
2. **Android Debug Bridge (ADB)**
3. **Frida** (optional, for dynamic analysis):
   ```bash
   pip install frida-tools
   ```

### Setup

1. Clone the repository:
   ```bash
   git clone https://github.com/gusdcoder/nfc-NXPNFCC_FW.git
   cd nfc-NXPNFCC_FW
   ```

2. Ensure ADB is working:
   ```bash
   adb devices
   ```

3. (Optional) Install Frida server on target device:
   ```bash
   # Download appropriate frida-server for your device architecture
   # Push to device and run with root privileges
   adb push frida-server-<version>-android-<arch> /data/local/tmp/frida-server
   adb shell "chmod 755 /data/local/tmp/frida-server"
   adb shell "su -c '/data/local/tmp/frida-server &'"
   ```

## Testing Scenarios

### Scenario 1: Firmware Security Assessment

Analyze NFC controller firmware for security vulnerabilities:

```bash
python3 hce_vuln_scanner.py --scan-firmware ./InfraFW --output firmware_report.json
```

This will:
- Scan all firmware files in the InfraFW directory
- Look for vulnerability patterns in ARM firmware code
- Check for hardcoded secrets and debugging artifacts
- Generate a detailed security report

### Scenario 2: Non-Root Device Analysis

Analyze HCE implementations without device root:

```bash
# Quick HCE app analysis
python3 non_root_hce_analyzer.py --analyze-apps

# Comprehensive non-root analysis
python3 non_root_hce_analyzer.py --all --output nonroot_report.json
```

This will:
- Enumerate HCE-enabled applications
- Check permissions and service configurations
- Test for AID conflicts between applications
- Analyze NFC intent handling security

### Scenario 3: Dynamic Runtime Analysis

Perform real-time analysis with Frida:

```bash
# Monitor for 10 minutes with detailed logging
python3 frida_hce_analyzer.py --duration 600 --output dynamic_analysis.json
```

This will:
- Hook critical NFC/HCE methods in real-time
- Intercept and analyze APDU commands
- Detect security violations and policy bypasses
- Monitor for sensitive data in memory

### Scenario 4: Comprehensive Security Audit

Complete security assessment combining all approaches:

```bash
# Full audit with all capabilities
python3 hce_vuln_scanner.py --scan-all --root --use-frida --output complete_audit.json
```

This performs:
- Static firmware analysis
- Device HCE implementation review
- Dynamic runtime monitoring (with Frida)
- Root-level system checks
- Comprehensive vulnerability reporting

## Sample Output

The tools generate structured JSON reports containing:

```json
{
  "scan_info": {
    "timestamp": "2025-01-28T10:30:00Z",
    "root_mode": true,
    "frida_enabled": true,
    "scanner_version": "1.0.0"
  },
  "summary": {
    "total_vulnerabilities": 7,
    "high_severity": 2,
    "medium_severity": 3,
    "low_severity": 2,
    "info_findings": 0
  },
  "firmware_analysis": {
    "files_scanned": 12,
    "vulnerabilities": [...],
    "firmware_versions": [...]
  },
  "hce_analysis": {
    "hce_apps": [...],
    "security_checks": [...],
    "frida_analysis": {...}
  },
  "recommendations": [
    "Implement proper bounds checking in firmware",
    "Use secure key storage mechanisms",
    "Review HCE app permissions",
    "Monitor NFC transaction patterns"
  ]
}
```

## Vulnerability Severity Levels

- **CRITICAL**: Immediate security risk requiring urgent attention
- **HIGH**: Significant security vulnerability that should be addressed quickly  
- **MEDIUM**: Moderate security concern that should be planned for resolution
- **LOW**: Minor security issue or hardening opportunity
- **INFO**: Informational finding for awareness

## Supported NFC Controllers

The toolkit has been tested with firmware from:

- **PN547C2, PN548AD, PN551, PN553, PN557** (NXP)
- **SN100, SN110, SN220, SN300** series
- Various firmware versions from Android 5.0 through Android 16

## Contributing

Contributions are welcome! Please:

1. Fork the repository
2. Create a feature branch
3. Add appropriate tests
4. Submit a pull request

## License

This project is licensed under the NXP Software License Agreement. See `LA_OPT_NXP_Software_License.pdf` for details.

## Security Notice

This tool is designed for legitimate security research and testing purposes. Users are responsible for:

- Obtaining proper authorization before testing devices
- Complying with applicable laws and regulations
- Using findings responsibly for security improvements
- Not using the tool for malicious purposes

## Troubleshooting

### Common Issues

**"Device not found" or ADB connection issues:**
```bash
# Check device connection
adb devices

# Restart ADB if needed  
adb kill-server && adb start-server

# Check USB debugging is enabled on device
```

**"Frida server not running" errors:**
```bash
# Ensure frida-server is running on device
adb shell "ps | grep frida"

# Restart frida-server if needed
adb shell "su -c 'killall frida-server; /data/local/tmp/frida-server &'"
```

**"Permission denied" for certain checks:**
```bash
# Some checks require root access - use --root flag
python3 hce_vuln_scanner.py --scan-device --root

# Or try non-root specific analyzer
python3 non_root_hce_analyzer.py --all
```

### Support

For technical support or questions:

1. Check the troubleshooting section above
2. Review the command-line help: `python3 <script> --help`
3. Enable verbose output with `--verbose` flag for debugging

## Changelog

### v1.0.0 (2025-01-28)
- Initial release
- Firmware vulnerability scanning
- Non-root HCE application analysis
- Frida-based dynamic analysis
- Comprehensive vulnerability reporting
- Support for latest NFC controller firmware versions